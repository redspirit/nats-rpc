# nats-rpc

–ü—Ä–æ—Å—Ç–∞—è –∏ —É–¥–æ–±–Ω–∞—è RPC- –∏ pub/sub-–æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ [NATS](https://nats.io/) –¥–ª—è Node.js.
–ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã –º–µ–∂–¥—É –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏ –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ async-—Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–æ–±—ã—Ç–∏—è–º–∏ (fire-and-forget).

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install nats-rpc
```

–¢–∞–∫–∂–µ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—â–µ–Ω–Ω—ã–π NATS-—Å–µ—Ä–≤–µ—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `nats://localhost:4222`):

```bash
docker run -d --name nats-server -p 4222:4222 -p 8222:8222 nats
```

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1) –°–æ–∑–¥–∞–Ω–∏–µ RPC-—Å–µ—Ä–≤–∏—Å–∞

```js
// math-service.js
import { RPC } from "nats-rpc-easy";

const rpc = new RPC("math");

await rpc.method("add", async ({ a, b }) => a + b);
await rpc.method("mul", async ({ a, b }) => a * b);

console.log("Math service running...");
```

### 2) –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ —Å –∫–ª–∏–µ–Ω—Ç–∞

```js
// client.js
import { RPC } from "nats-rpc-easy";

const math = new RPC("math");

const run = async () => {
  const sum = await math.call("add", { a: 2, b: 3 });
  const mul = await math.call("mul", { a: 4, b: 5 });

  console.log("2 + 3 =", sum);
  console.log("4 * 5 =", mul);
};

run();
```

---

## üîî Pub/Sub (—Å–æ–±—ã—Ç–∏—è)

### –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è (fire-and-forget)

```js
import { RPC } from "nats-rpc-easy";

const user = new RPC("user");

await user.emit("created", { id: 1, name: "Alice" });
console.log("Event sent: user.created");
```

### –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ

```js
import { RPC } from "nats-rpc-easy";

const user = new RPC("user");

await user.on("created", async (data) => {
  console.log("New user created:", data);
});
```

---

## üéØ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–º—É –∫–ª–∏–µ–Ω—Ç—É

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—É—á–∏–ª **—Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω** –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ **queue group**.

```js
// worker1.js
await rpc.on("jobs.process", async (job) => {
  console.log("Worker 1 processed:", job);
}, "workers");

// worker2.js (—Ç–æ–∂–µ –≤ –≥—Ä—É–ø–ø–µ "workers")
await rpc.on("jobs.process", async (job) => {
  console.log("Worker 2 processed:", job);
}, "workers");

// publisher.js
await rpc.emit("jobs.process", { task: "resize-image" });
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–∑ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –≤ –≥—Ä—É–ø–ø–µ `workers` –ø–æ–ª—É—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ.

---

## ‚öôÔ∏è API

### –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```js
const rpc = new RPC(serviceName?, url?);
```

* `serviceName` ‚Äî (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Å—Ç—Ä–æ–∫–∞, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–µ—Ñ–∏–∫—Å –∫ subject: `serviceName.method`.
* `url` ‚Äî –∞–¥—Ä–µ—Å NATS-—Å–µ—Ä–≤–µ—Ä–∞. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é `nats://localhost:4222`.

### –ú–µ—Ç–æ–¥—ã

* `await rpc.method(name, handler)` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç RPC-–º–µ—Ç–æ–¥. `handler` –º–æ–∂–µ—Ç –±—ã—Ç—å async –∏ –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
* `await rpc.call(name, data, timeout?)` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç RPC-–º–µ—Ç–æ–¥ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç. `timeout` –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1000`).
* `await rpc.emit(event, data)` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ (fire-and-forget) –≤—Å–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–∞–º.
* `await rpc.on(event, handler, queueGroup?)` ‚Äî –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏–µ; –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è `queueGroup` –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

* **–¢–∏–ø–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã:** NATS –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∏/–±–∞–π—Ç—ã ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–≥–æ JSON-—Å—Ö–µ–º—ã (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å protobuf –≤ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö).
* **Timeouts:** –∑–∞–¥–∞–≤–∞–π—Ç–µ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π `timeout` –¥–ª—è `call`, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –Ω–µ–æ—Ç–≤–µ—Ç–µ —Å–µ—Ä–≤–∏—Å–∞.
* **Health & retries:** —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏/–ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. NATS –∫–ª–∏–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫—É –ª–æ–≥–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å—Ç–æ–∏—Ç –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ—Ç—å.

---

## üß™ –ü—Ä–∏–º–µ—Ä docker-compose (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

```yaml
services:
  nats:
    image: nats:latest
    ports:
      - "4222:4222"
      - "8222:8222" # monitoring
```

–ó–∞–ø—É—Å–∫–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π nats-server, –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–æ `nats://localhost:4222`.

---

## üõ†Ô∏è –û—Ç–ª–∞–¥–∫–∞

* –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `nats-server` —Å–ª—É—à–∞–µ—Ç –Ω–∞ –æ–∂–∏–¥–∞–µ–º–æ–º –ø–æ—Ä—Ç—É.
* –í –ª–æ–≥–∞—Ö NATS (–ø–æ—Ä—Ç `8222`) –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.
* –ï—Å–ª–∏ `rpc.call` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ç–∞–π–º–∞—É—Ç ‚Äî —É–≤–µ–ª–∏—á—å—Ç–µ `timeout` –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å —Å –º–µ—Ç–æ–¥–æ–º –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—â–µ–Ω.

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

MIT ¬© 2025
